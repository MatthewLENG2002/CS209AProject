{"ast":null,"code":"require(\"core-js/modules/es.array.push.js\");\n/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\n\nvar echarts = require(\"../../echarts\");\nvar zrUtil = require(\"zrender/lib/core/util\");\nvar graphic = require(\"../../util/graphic\");\nvar DataDiffer = require(\"../../data/DataDiffer\");\nvar helper = require(\"../helper/treeHelper\");\nvar Breadcrumb = require(\"./Breadcrumb\");\nvar RoamController = require(\"../../component/helper/RoamController\");\nvar BoundingRect = require(\"zrender/lib/core/BoundingRect\");\nvar matrix = require(\"zrender/lib/core/matrix\");\nvar animationUtil = require(\"../../util/animation\");\nvar makeStyleMapper = require(\"../../model/mixin/makeStyleMapper\");\n\n/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\nvar bind = zrUtil.bind;\nvar Group = graphic.Group;\nvar Rect = graphic.Rect;\nvar each = zrUtil.each;\nvar DRAG_THRESHOLD = 3;\nvar PATH_LABEL_NOAMAL = ['label'];\nvar PATH_LABEL_EMPHASIS = ['emphasis', 'label'];\nvar PATH_UPPERLABEL_NORMAL = ['upperLabel'];\nvar PATH_UPPERLABEL_EMPHASIS = ['emphasis', 'upperLabel'];\nvar Z_BASE = 10; // Should bigger than every z.\n\nvar Z_BG = 1;\nvar Z_CONTENT = 2;\nvar getItemStyleEmphasis = makeStyleMapper([['fill', 'color'],\n// `borderColor` and `borderWidth` has been occupied,\n// so use `stroke` to indicate the stroke of the rect.\n['stroke', 'strokeColor'], ['lineWidth', 'strokeWidth'], ['shadowBlur'], ['shadowOffsetX'], ['shadowOffsetY'], ['shadowColor']]);\nvar getItemStyleNormal = function (model) {\n  // Normal style props should include emphasis style props.\n  var itemStyle = getItemStyleEmphasis(model); // Clear styles set by emphasis.\n\n  itemStyle.stroke = itemStyle.fill = itemStyle.lineWidth = null;\n  return itemStyle;\n};\nvar _default = echarts.extendChartView({\n  type: 'treemap',\n  /**\n   * @override\n   */\n  init: function (o, api) {\n    /**\n     * @private\n     * @type {module:zrender/container/Group}\n     */\n    this._containerGroup;\n    /**\n     * @private\n     * @type {Object.<string, Array.<module:zrender/container/Group>>}\n     */\n\n    this._storage = createStorage();\n    /**\n     * @private\n     * @type {module:echarts/data/Tree}\n     */\n\n    this._oldTree;\n    /**\n     * @private\n     * @type {module:echarts/chart/treemap/Breadcrumb}\n     */\n\n    this._breadcrumb;\n    /**\n     * @private\n     * @type {module:echarts/component/helper/RoamController}\n     */\n\n    this._controller;\n    /**\n     * 'ready', 'animating'\n     * @private\n     */\n\n    this._state = 'ready';\n  },\n  /**\n   * @override\n   */\n  render: function (seriesModel, ecModel, api, payload) {\n    var models = ecModel.findComponents({\n      mainType: 'series',\n      subType: 'treemap',\n      query: payload\n    });\n    if (zrUtil.indexOf(models, seriesModel) < 0) {\n      return;\n    }\n    this.seriesModel = seriesModel;\n    this.api = api;\n    this.ecModel = ecModel;\n    var types = ['treemapZoomToNode', 'treemapRootToNode'];\n    var targetInfo = helper.retrieveTargetInfo(payload, types, seriesModel);\n    var payloadType = payload && payload.type;\n    var layoutInfo = seriesModel.layoutInfo;\n    var isInit = !this._oldTree;\n    var thisStorage = this._storage; // Mark new root when action is treemapRootToNode.\n\n    var reRoot = payloadType === 'treemapRootToNode' && targetInfo && thisStorage ? {\n      rootNodeGroup: thisStorage.nodeGroup[targetInfo.node.getRawIndex()],\n      direction: payload.direction\n    } : null;\n    var containerGroup = this._giveContainerGroup(layoutInfo);\n    var renderResult = this._doRender(containerGroup, seriesModel, reRoot);\n    !isInit && (!payloadType || payloadType === 'treemapZoomToNode' || payloadType === 'treemapRootToNode') ? this._doAnimation(containerGroup, renderResult, seriesModel, reRoot) : renderResult.renderFinally();\n    this._resetController(api);\n    this._renderBreadcrumb(seriesModel, api, targetInfo);\n  },\n  /**\n   * @private\n   */\n  _giveContainerGroup: function (layoutInfo) {\n    var containerGroup = this._containerGroup;\n    if (!containerGroup) {\n      // FIXME\n      // 加一层containerGroup是为了clip，但是现在clip功能并没有实现。\n      containerGroup = this._containerGroup = new Group();\n      this._initEvents(containerGroup);\n      this.group.add(containerGroup);\n    }\n    containerGroup.attr('position', [layoutInfo.x, layoutInfo.y]);\n    return containerGroup;\n  },\n  /**\n   * @private\n   */\n  _doRender: function (containerGroup, seriesModel, reRoot) {\n    var thisTree = seriesModel.getData().tree;\n    var oldTree = this._oldTree; // Clear last shape records.\n\n    var lastsForAnimation = createStorage();\n    var thisStorage = createStorage();\n    var oldStorage = this._storage;\n    var willInvisibleEls = [];\n    var doRenderNode = zrUtil.curry(renderNode, seriesModel, thisStorage, oldStorage, reRoot, lastsForAnimation, willInvisibleEls); // Notice: when thisTree and oldTree are the same tree (see list.cloneShallow),\n    // the oldTree is actually losted, so we can not find all of the old graphic\n    // elements from tree. So we use this stragegy: make element storage, move\n    // from old storage to new storage, clear old storage.\n\n    dualTravel(thisTree.root ? [thisTree.root] : [], oldTree && oldTree.root ? [oldTree.root] : [], containerGroup, thisTree === oldTree || !oldTree, 0); // Process all removing.\n\n    var willDeleteEls = clearStorage(oldStorage);\n    this._oldTree = thisTree;\n    this._storage = thisStorage;\n    return {\n      lastsForAnimation: lastsForAnimation,\n      willDeleteEls: willDeleteEls,\n      renderFinally: renderFinally\n    };\n    function dualTravel(thisViewChildren, oldViewChildren, parentGroup, sameTree, depth) {\n      // When 'render' is triggered by action,\n      // 'this' and 'old' may be the same tree,\n      // we use rawIndex in that case.\n      if (sameTree) {\n        oldViewChildren = thisViewChildren;\n        each(thisViewChildren, function (child, index) {\n          !child.isRemoved() && processNode(index, index);\n        });\n      } // Diff hierarchically (diff only in each subtree, but not whole).\n      // because, consistency of view is important.\n      else {\n        new DataDiffer(oldViewChildren, thisViewChildren, getKey, getKey).add(processNode).update(processNode).remove(zrUtil.curry(processNode, null)).execute();\n      }\n      function getKey(node) {\n        // Identify by name or raw index.\n        return node.getId();\n      }\n      function processNode(newIndex, oldIndex) {\n        var thisNode = newIndex != null ? thisViewChildren[newIndex] : null;\n        var oldNode = oldIndex != null ? oldViewChildren[oldIndex] : null;\n        var group = doRenderNode(thisNode, oldNode, parentGroup, depth);\n        group && dualTravel(thisNode && thisNode.viewChildren || [], oldNode && oldNode.viewChildren || [], group, sameTree, depth + 1);\n      }\n    }\n    function clearStorage(storage) {\n      var willDeleteEls = createStorage();\n      storage && each(storage, function (store, storageName) {\n        var delEls = willDeleteEls[storageName];\n        each(store, function (el) {\n          el && (delEls.push(el), el.__tmWillDelete = 1);\n        });\n      });\n      return willDeleteEls;\n    }\n    function renderFinally() {\n      each(willDeleteEls, function (els) {\n        each(els, function (el) {\n          el.parent && el.parent.remove(el);\n        });\n      });\n      each(willInvisibleEls, function (el) {\n        el.invisible = true; // Setting invisible is for optimizing, so no need to set dirty,\n        // just mark as invisible.\n\n        el.dirty();\n      });\n    }\n  },\n  /**\n   * @private\n   */\n  _doAnimation: function (containerGroup, renderResult, seriesModel, reRoot) {\n    if (!seriesModel.get('animation')) {\n      return;\n    }\n    var duration = seriesModel.get('animationDurationUpdate');\n    var easing = seriesModel.get('animationEasing');\n    var animationWrap = animationUtil.createWrap(); // Make delete animations.\n\n    each(renderResult.willDeleteEls, function (store, storageName) {\n      each(store, function (el, rawIndex) {\n        if (el.invisible) {\n          return;\n        }\n        var parent = el.parent; // Always has parent, and parent is nodeGroup.\n\n        var target;\n        if (reRoot && reRoot.direction === 'drillDown') {\n          target = parent === reRoot.rootNodeGroup // This is the content element of view root.\n          // Only `content` will enter this branch, because\n          // `background` and `nodeGroup` will not be deleted.\n          ? {\n            shape: {\n              x: 0,\n              y: 0,\n              width: parent.__tmNodeWidth,\n              height: parent.__tmNodeHeight\n            },\n            style: {\n              opacity: 0\n            } // Others.\n          } : {\n            style: {\n              opacity: 0\n            }\n          };\n        } else {\n          var targetX = 0;\n          var targetY = 0;\n          if (!parent.__tmWillDelete) {\n            // Let node animate to right-bottom corner, cooperating with fadeout,\n            // which is appropriate for user understanding.\n            // Divided by 2 for reRoot rolling up effect.\n            targetX = parent.__tmNodeWidth / 2;\n            targetY = parent.__tmNodeHeight / 2;\n          }\n          target = storageName === 'nodeGroup' ? {\n            position: [targetX, targetY],\n            style: {\n              opacity: 0\n            }\n          } : {\n            shape: {\n              x: targetX,\n              y: targetY,\n              width: 0,\n              height: 0\n            },\n            style: {\n              opacity: 0\n            }\n          };\n        }\n        target && animationWrap.add(el, target, duration, easing);\n      });\n    }); // Make other animations\n\n    each(this._storage, function (store, storageName) {\n      each(store, function (el, rawIndex) {\n        var last = renderResult.lastsForAnimation[storageName][rawIndex];\n        var target = {};\n        if (!last) {\n          return;\n        }\n        if (storageName === 'nodeGroup') {\n          if (last.old) {\n            target.position = el.position.slice();\n            el.attr('position', last.old);\n          }\n        } else {\n          if (last.old) {\n            target.shape = zrUtil.extend({}, el.shape);\n            el.setShape(last.old);\n          }\n          if (last.fadein) {\n            el.setStyle('opacity', 0);\n            target.style = {\n              opacity: 1\n            };\n          } // When animation is stopped for succedent animation starting,\n          // el.style.opacity might not be 1\n          else if (el.style.opacity !== 1) {\n            target.style = {\n              opacity: 1\n            };\n          }\n        }\n        animationWrap.add(el, target, duration, easing);\n      });\n    }, this);\n    this._state = 'animating';\n    animationWrap.done(bind(function () {\n      this._state = 'ready';\n      renderResult.renderFinally();\n    }, this)).start();\n  },\n  /**\n   * @private\n   */\n  _resetController: function (api) {\n    var controller = this._controller; // Init controller.\n\n    if (!controller) {\n      controller = this._controller = new RoamController(api.getZr());\n      controller.enable(this.seriesModel.get('roam'));\n      controller.on('pan', bind(this._onPan, this));\n      controller.on('zoom', bind(this._onZoom, this));\n    }\n    var rect = new BoundingRect(0, 0, api.getWidth(), api.getHeight());\n    controller.setPointerChecker(function (e, x, y) {\n      return rect.contain(x, y);\n    });\n  },\n  /**\n   * @private\n   */\n  _clearController: function () {\n    var controller = this._controller;\n    if (controller) {\n      controller.dispose();\n      controller = null;\n    }\n  },\n  /**\n   * @private\n   */\n  _onPan: function (e) {\n    if (this._state !== 'animating' && (Math.abs(e.dx) > DRAG_THRESHOLD || Math.abs(e.dy) > DRAG_THRESHOLD)) {\n      // These param must not be cached.\n      var root = this.seriesModel.getData().tree.root;\n      if (!root) {\n        return;\n      }\n      var rootLayout = root.getLayout();\n      if (!rootLayout) {\n        return;\n      }\n      this.api.dispatchAction({\n        type: 'treemapMove',\n        from: this.uid,\n        seriesId: this.seriesModel.id,\n        rootRect: {\n          x: rootLayout.x + e.dx,\n          y: rootLayout.y + e.dy,\n          width: rootLayout.width,\n          height: rootLayout.height\n        }\n      });\n    }\n  },\n  /**\n   * @private\n   */\n  _onZoom: function (e) {\n    var mouseX = e.originX;\n    var mouseY = e.originY;\n    if (this._state !== 'animating') {\n      // These param must not be cached.\n      var root = this.seriesModel.getData().tree.root;\n      if (!root) {\n        return;\n      }\n      var rootLayout = root.getLayout();\n      if (!rootLayout) {\n        return;\n      }\n      var rect = new BoundingRect(rootLayout.x, rootLayout.y, rootLayout.width, rootLayout.height);\n      var layoutInfo = this.seriesModel.layoutInfo; // Transform mouse coord from global to containerGroup.\n\n      mouseX -= layoutInfo.x;\n      mouseY -= layoutInfo.y; // Scale root bounding rect.\n\n      var m = matrix.create();\n      matrix.translate(m, m, [-mouseX, -mouseY]);\n      matrix.scale(m, m, [e.scale, e.scale]);\n      matrix.translate(m, m, [mouseX, mouseY]);\n      rect.applyTransform(m);\n      this.api.dispatchAction({\n        type: 'treemapRender',\n        from: this.uid,\n        seriesId: this.seriesModel.id,\n        rootRect: {\n          x: rect.x,\n          y: rect.y,\n          width: rect.width,\n          height: rect.height\n        }\n      });\n    }\n  },\n  /**\n   * @private\n   */\n  _initEvents: function (containerGroup) {\n    containerGroup.on('click', function (e) {\n      if (this._state !== 'ready') {\n        return;\n      }\n      var nodeClick = this.seriesModel.get('nodeClick', true);\n      if (!nodeClick) {\n        return;\n      }\n      var targetInfo = this.findTarget(e.offsetX, e.offsetY);\n      if (!targetInfo) {\n        return;\n      }\n      var node = targetInfo.node;\n      if (node.getLayout().isLeafRoot) {\n        this._rootToNode(targetInfo);\n      } else {\n        if (nodeClick === 'zoomToNode') {\n          this._zoomToNode(targetInfo);\n        } else if (nodeClick === 'link') {\n          var itemModel = node.hostTree.data.getItemModel(node.dataIndex);\n          var link = itemModel.get('link', true);\n          var linkTarget = itemModel.get('target', true) || 'blank';\n          link && window.open(link, linkTarget);\n        }\n      }\n    }, this);\n  },\n  /**\n   * @private\n   */\n  _renderBreadcrumb: function (seriesModel, api, targetInfo) {\n    if (!targetInfo) {\n      targetInfo = seriesModel.get('leafDepth', true) != null ? {\n        node: seriesModel.getViewRoot() // FIXME\n        // better way?\n        // Find breadcrumb tail on center of containerGroup.\n      } : this.findTarget(api.getWidth() / 2, api.getHeight() / 2);\n      if (!targetInfo) {\n        targetInfo = {\n          node: seriesModel.getData().tree.root\n        };\n      }\n    }\n    (this._breadcrumb || (this._breadcrumb = new Breadcrumb(this.group))).render(seriesModel, api, targetInfo.node, bind(onSelect, this));\n    function onSelect(node) {\n      if (this._state !== 'animating') {\n        helper.aboveViewRoot(seriesModel.getViewRoot(), node) ? this._rootToNode({\n          node: node\n        }) : this._zoomToNode({\n          node: node\n        });\n      }\n    }\n  },\n  /**\n   * @override\n   */\n  remove: function () {\n    this._clearController();\n    this._containerGroup && this._containerGroup.removeAll();\n    this._storage = createStorage();\n    this._state = 'ready';\n    this._breadcrumb && this._breadcrumb.remove();\n  },\n  dispose: function () {\n    this._clearController();\n  },\n  /**\n   * @private\n   */\n  _zoomToNode: function (targetInfo) {\n    this.api.dispatchAction({\n      type: 'treemapZoomToNode',\n      from: this.uid,\n      seriesId: this.seriesModel.id,\n      targetNode: targetInfo.node\n    });\n  },\n  /**\n   * @private\n   */\n  _rootToNode: function (targetInfo) {\n    this.api.dispatchAction({\n      type: 'treemapRootToNode',\n      from: this.uid,\n      seriesId: this.seriesModel.id,\n      targetNode: targetInfo.node\n    });\n  },\n  /**\n   * @public\n   * @param {number} x Global coord x.\n   * @param {number} y Global coord y.\n   * @return {Object} info If not found, return undefined;\n   * @return {number} info.node Target node.\n   * @return {number} info.offsetX x refer to target node.\n   * @return {number} info.offsetY y refer to target node.\n   */\n  findTarget: function (x, y) {\n    var targetInfo;\n    var viewRoot = this.seriesModel.getViewRoot();\n    viewRoot.eachNode({\n      attr: 'viewChildren',\n      order: 'preorder'\n    }, function (node) {\n      var bgEl = this._storage.background[node.getRawIndex()]; // If invisible, there might be no element.\n\n      if (bgEl) {\n        var point = bgEl.transformCoordToLocal(x, y);\n        var shape = bgEl.shape; // For performance consideration, dont use 'getBoundingRect'.\n\n        if (shape.x <= point[0] && point[0] <= shape.x + shape.width && shape.y <= point[1] && point[1] <= shape.y + shape.height) {\n          targetInfo = {\n            node: node,\n            offsetX: point[0],\n            offsetY: point[1]\n          };\n        } else {\n          return false; // Suppress visit subtree.\n        }\n      }\n    }, this);\n    return targetInfo;\n  }\n});\n/**\n * @inner\n */\n\nfunction createStorage() {\n  return {\n    nodeGroup: [],\n    background: [],\n    content: []\n  };\n}\n/**\n * @inner\n * @return Return undefined means do not travel further.\n */\n\nfunction renderNode(seriesModel, thisStorage, oldStorage, reRoot, lastsForAnimation, willInvisibleEls, thisNode, oldNode, parentGroup, depth) {\n  // Whether under viewRoot.\n  if (!thisNode) {\n    // Deleting nodes will be performed finally. This method just find\n    // element from old storage, or create new element, set them to new\n    // storage, and set styles.\n    return;\n  } // -------------------------------------------------------------------\n  // Start of closure variables available in \"Procedures in renderNode\".\n\n  var thisLayout = thisNode.getLayout();\n  if (!thisLayout || !thisLayout.isInView) {\n    return;\n  }\n  var thisWidth = thisLayout.width;\n  var thisHeight = thisLayout.height;\n  var borderWidth = thisLayout.borderWidth;\n  var thisInvisible = thisLayout.invisible;\n  var thisRawIndex = thisNode.getRawIndex();\n  var oldRawIndex = oldNode && oldNode.getRawIndex();\n  var thisViewChildren = thisNode.viewChildren;\n  var upperHeight = thisLayout.upperHeight;\n  var isParent = thisViewChildren && thisViewChildren.length;\n  var itemStyleNormalModel = thisNode.getModel('itemStyle');\n  var itemStyleEmphasisModel = thisNode.getModel('emphasis.itemStyle'); // End of closure ariables available in \"Procedures in renderNode\".\n  // -----------------------------------------------------------------\n  // Node group\n\n  var group = giveGraphic('nodeGroup', Group);\n  if (!group) {\n    return;\n  }\n  parentGroup.add(group); // x,y are not set when el is above view root.\n\n  group.attr('position', [thisLayout.x || 0, thisLayout.y || 0]);\n  group.__tmNodeWidth = thisWidth;\n  group.__tmNodeHeight = thisHeight;\n  if (thisLayout.isAboveViewRoot) {\n    return group;\n  } // Background\n\n  var bg = giveGraphic('background', Rect, depth, Z_BG);\n  bg && renderBackground(group, bg, isParent && thisLayout.upperHeight); // No children, render content.\n\n  if (!isParent) {\n    var content = giveGraphic('content', Rect, depth, Z_CONTENT);\n    content && renderContent(group, content);\n  }\n  return group; // ----------------------------\n  // | Procedures in renderNode |\n  // ----------------------------\n\n  function renderBackground(group, bg, useUpperLabel) {\n    // For tooltip.\n    bg.dataIndex = thisNode.dataIndex;\n    bg.seriesIndex = seriesModel.seriesIndex;\n    bg.setShape({\n      x: 0,\n      y: 0,\n      width: thisWidth,\n      height: thisHeight\n    });\n    var visualBorderColor = thisNode.getVisual('borderColor', true);\n    var emphasisBorderColor = itemStyleEmphasisModel.get('borderColor');\n    updateStyle(bg, function () {\n      var normalStyle = getItemStyleNormal(itemStyleNormalModel);\n      normalStyle.fill = visualBorderColor;\n      var emphasisStyle = getItemStyleEmphasis(itemStyleEmphasisModel);\n      emphasisStyle.fill = emphasisBorderColor;\n      if (useUpperLabel) {\n        var upperLabelWidth = thisWidth - 2 * borderWidth;\n        prepareText(normalStyle, emphasisStyle, visualBorderColor, upperLabelWidth, upperHeight, {\n          x: borderWidth,\n          y: 0,\n          width: upperLabelWidth,\n          height: upperHeight\n        });\n      } // For old bg.\n      else {\n        normalStyle.text = emphasisStyle.text = null;\n      }\n      bg.setStyle(normalStyle);\n      graphic.setHoverStyle(bg, emphasisStyle);\n    });\n    group.add(bg);\n  }\n  function renderContent(group, content) {\n    // For tooltip.\n    content.dataIndex = thisNode.dataIndex;\n    content.seriesIndex = seriesModel.seriesIndex;\n    var contentWidth = Math.max(thisWidth - 2 * borderWidth, 0);\n    var contentHeight = Math.max(thisHeight - 2 * borderWidth, 0);\n    content.culling = true;\n    content.setShape({\n      x: borderWidth,\n      y: borderWidth,\n      width: contentWidth,\n      height: contentHeight\n    });\n    var visualColor = thisNode.getVisual('color', true);\n    updateStyle(content, function () {\n      var normalStyle = getItemStyleNormal(itemStyleNormalModel);\n      normalStyle.fill = visualColor;\n      var emphasisStyle = getItemStyleEmphasis(itemStyleEmphasisModel);\n      prepareText(normalStyle, emphasisStyle, visualColor, contentWidth, contentHeight);\n      content.setStyle(normalStyle);\n      graphic.setHoverStyle(content, emphasisStyle);\n    });\n    group.add(content);\n  }\n  function updateStyle(element, cb) {\n    if (!thisInvisible) {\n      // If invisible, do not set visual, otherwise the element will\n      // change immediately before animation. We think it is OK to\n      // remain its origin color when moving out of the view window.\n      cb();\n      if (!element.__tmWillVisible) {\n        element.invisible = false;\n      }\n    } else {\n      // Delay invisible setting utill animation finished,\n      // avoid element vanish suddenly before animation.\n      !element.invisible && willInvisibleEls.push(element);\n    }\n  }\n  function prepareText(normalStyle, emphasisStyle, visualColor, width, height, upperLabelRect) {\n    var nodeModel = thisNode.getModel();\n    var text = zrUtil.retrieve(seriesModel.getFormattedLabel(thisNode.dataIndex, 'normal', null, null, upperLabelRect ? 'upperLabel' : 'label'), nodeModel.get('name'));\n    if (!upperLabelRect && thisLayout.isLeafRoot) {\n      var iconChar = seriesModel.get('drillDownIcon', true);\n      text = iconChar ? iconChar + ' ' + text : text;\n    }\n    var normalLabelModel = nodeModel.getModel(upperLabelRect ? PATH_UPPERLABEL_NORMAL : PATH_LABEL_NOAMAL);\n    var emphasisLabelModel = nodeModel.getModel(upperLabelRect ? PATH_UPPERLABEL_EMPHASIS : PATH_LABEL_EMPHASIS);\n    var isShow = normalLabelModel.getShallow('show');\n    graphic.setLabelStyle(normalStyle, emphasisStyle, normalLabelModel, emphasisLabelModel, {\n      defaultText: isShow ? text : null,\n      autoColor: visualColor,\n      isRectText: true\n    });\n    upperLabelRect && (normalStyle.textRect = zrUtil.clone(upperLabelRect));\n    normalStyle.truncate = isShow && normalLabelModel.get('ellipsis') ? {\n      outerWidth: width,\n      outerHeight: height,\n      minChar: 2\n    } : null;\n  }\n  function giveGraphic(storageName, Ctor, depth, z) {\n    var element = oldRawIndex != null && oldStorage[storageName][oldRawIndex];\n    var lasts = lastsForAnimation[storageName];\n    if (element) {\n      // Remove from oldStorage\n      oldStorage[storageName][oldRawIndex] = null;\n      prepareAnimationWhenHasOld(lasts, element, storageName);\n    } // If invisible and no old element, do not create new element (for optimizing).\n    else if (!thisInvisible) {\n      element = new Ctor({\n        z: calculateZ(depth, z)\n      });\n      element.__tmDepth = depth;\n      element.__tmStorageName = storageName;\n      prepareAnimationWhenNoOld(lasts, element, storageName);\n    } // Set to thisStorage\n\n    return thisStorage[storageName][thisRawIndex] = element;\n  }\n  function prepareAnimationWhenHasOld(lasts, element, storageName) {\n    var lastCfg = lasts[thisRawIndex] = {};\n    lastCfg.old = storageName === 'nodeGroup' ? element.position.slice() : zrUtil.extend({}, element.shape);\n  } // If a element is new, we need to find the animation start point carefully,\n  // otherwise it will looks strange when 'zoomToNode'.\n\n  function prepareAnimationWhenNoOld(lasts, element, storageName) {\n    var lastCfg = lasts[thisRawIndex] = {};\n    var parentNode = thisNode.parentNode;\n    if (parentNode && (!reRoot || reRoot.direction === 'drillDown')) {\n      var parentOldX = 0;\n      var parentOldY = 0; // New nodes appear from right-bottom corner in 'zoomToNode' animation.\n      // For convenience, get old bounding rect from background.\n\n      var parentOldBg = lastsForAnimation.background[parentNode.getRawIndex()];\n      if (!reRoot && parentOldBg && parentOldBg.old) {\n        parentOldX = parentOldBg.old.width;\n        parentOldY = parentOldBg.old.height;\n      } // When no parent old shape found, its parent is new too,\n      // so we can just use {x:0, y:0}.\n\n      lastCfg.old = storageName === 'nodeGroup' ? [0, parentOldY] : {\n        x: parentOldX,\n        y: parentOldY,\n        width: 0,\n        height: 0\n      };\n    } // Fade in, user can be aware that these nodes are new.\n\n    lastCfg.fadein = storageName !== 'nodeGroup';\n  }\n} // We can not set all backgroud with the same z, Because the behaviour of\n// drill down and roll up differ background creation sequence from tree\n// hierarchy sequence, which cause that lowser background element overlap\n// upper ones. So we calculate z based on depth.\n// Moreover, we try to shrink down z interval to [0, 1] to avoid that\n// treemap with large z overlaps other components.\n\nfunction calculateZ(depth, zInLevel) {\n  var zb = depth * Z_BASE + zInLevel;\n  return (zb - 1) / zb;\n}\nmodule.exports = _default;","map":{"version":3,"names":["echarts","require","zrUtil","graphic","DataDiffer","helper","Breadcrumb","RoamController","BoundingRect","matrix","animationUtil","makeStyleMapper","bind","Group","Rect","each","DRAG_THRESHOLD","PATH_LABEL_NOAMAL","PATH_LABEL_EMPHASIS","PATH_UPPERLABEL_NORMAL","PATH_UPPERLABEL_EMPHASIS","Z_BASE","Z_BG","Z_CONTENT","getItemStyleEmphasis","getItemStyleNormal","model","itemStyle","stroke","fill","lineWidth","_default","extendChartView","type","init","o","api","_containerGroup","_storage","createStorage","_oldTree","_breadcrumb","_controller","_state","render","seriesModel","ecModel","payload","models","findComponents","mainType","subType","query","indexOf","types","targetInfo","retrieveTargetInfo","payloadType","layoutInfo","isInit","thisStorage","reRoot","rootNodeGroup","nodeGroup","node","getRawIndex","direction","containerGroup","_giveContainerGroup","renderResult","_doRender","_doAnimation","renderFinally","_resetController","_renderBreadcrumb","_initEvents","group","add","attr","x","y","thisTree","getData","tree","oldTree","lastsForAnimation","oldStorage","willInvisibleEls","doRenderNode","curry","renderNode","dualTravel","root","willDeleteEls","clearStorage","thisViewChildren","oldViewChildren","parentGroup","sameTree","depth","child","index","isRemoved","processNode","getKey","update","remove","execute","getId","newIndex","oldIndex","thisNode","oldNode","viewChildren","storage","store","storageName","delEls","el","push","__tmWillDelete","els","parent","invisible","dirty","get","duration","easing","animationWrap","createWrap","rawIndex","target","shape","width","__tmNodeWidth","height","__tmNodeHeight","style","opacity","targetX","targetY","position","last","old","slice","extend","setShape","fadein","setStyle","done","start","controller","getZr","enable","on","_onPan","_onZoom","rect","getWidth","getHeight","setPointerChecker","e","contain","_clearController","dispose","Math","abs","dx","dy","rootLayout","getLayout","dispatchAction","from","uid","seriesId","id","rootRect","mouseX","originX","mouseY","originY","m","create","translate","scale","applyTransform","nodeClick","findTarget","offsetX","offsetY","isLeafRoot","_rootToNode","_zoomToNode","itemModel","hostTree","data","getItemModel","dataIndex","link","linkTarget","window","open","getViewRoot","onSelect","aboveViewRoot","removeAll","targetNode","viewRoot","eachNode","order","bgEl","background","point","transformCoordToLocal","content","thisLayout","isInView","thisWidth","thisHeight","borderWidth","thisInvisible","thisRawIndex","oldRawIndex","upperHeight","isParent","length","itemStyleNormalModel","getModel","itemStyleEmphasisModel","giveGraphic","isAboveViewRoot","bg","renderBackground","renderContent","useUpperLabel","seriesIndex","visualBorderColor","getVisual","emphasisBorderColor","updateStyle","normalStyle","emphasisStyle","upperLabelWidth","prepareText","text","setHoverStyle","contentWidth","max","contentHeight","culling","visualColor","element","cb","__tmWillVisible","upperLabelRect","nodeModel","retrieve","getFormattedLabel","iconChar","normalLabelModel","emphasisLabelModel","isShow","getShallow","setLabelStyle","defaultText","autoColor","isRectText","textRect","clone","truncate","outerWidth","outerHeight","minChar","Ctor","z","lasts","prepareAnimationWhenHasOld","calculateZ","__tmDepth","__tmStorageName","prepareAnimationWhenNoOld","lastCfg","parentNode","parentOldX","parentOldY","parentOldBg","zInLevel","zb","module","exports"],"sources":["/Users/tangxinyu/WebstormProjects/cs209a_proj/node_modules/echarts/lib/chart/treemap/TreemapView.js"],"sourcesContent":["\n/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\n\nvar echarts = require(\"../../echarts\");\n\nvar zrUtil = require(\"zrender/lib/core/util\");\n\nvar graphic = require(\"../../util/graphic\");\n\nvar DataDiffer = require(\"../../data/DataDiffer\");\n\nvar helper = require(\"../helper/treeHelper\");\n\nvar Breadcrumb = require(\"./Breadcrumb\");\n\nvar RoamController = require(\"../../component/helper/RoamController\");\n\nvar BoundingRect = require(\"zrender/lib/core/BoundingRect\");\n\nvar matrix = require(\"zrender/lib/core/matrix\");\n\nvar animationUtil = require(\"../../util/animation\");\n\nvar makeStyleMapper = require(\"../../model/mixin/makeStyleMapper\");\n\n/*\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\nvar bind = zrUtil.bind;\nvar Group = graphic.Group;\nvar Rect = graphic.Rect;\nvar each = zrUtil.each;\nvar DRAG_THRESHOLD = 3;\nvar PATH_LABEL_NOAMAL = ['label'];\nvar PATH_LABEL_EMPHASIS = ['emphasis', 'label'];\nvar PATH_UPPERLABEL_NORMAL = ['upperLabel'];\nvar PATH_UPPERLABEL_EMPHASIS = ['emphasis', 'upperLabel'];\nvar Z_BASE = 10; // Should bigger than every z.\n\nvar Z_BG = 1;\nvar Z_CONTENT = 2;\nvar getItemStyleEmphasis = makeStyleMapper([['fill', 'color'], // `borderColor` and `borderWidth` has been occupied,\n// so use `stroke` to indicate the stroke of the rect.\n['stroke', 'strokeColor'], ['lineWidth', 'strokeWidth'], ['shadowBlur'], ['shadowOffsetX'], ['shadowOffsetY'], ['shadowColor']]);\n\nvar getItemStyleNormal = function (model) {\n  // Normal style props should include emphasis style props.\n  var itemStyle = getItemStyleEmphasis(model); // Clear styles set by emphasis.\n\n  itemStyle.stroke = itemStyle.fill = itemStyle.lineWidth = null;\n  return itemStyle;\n};\n\nvar _default = echarts.extendChartView({\n  type: 'treemap',\n\n  /**\n   * @override\n   */\n  init: function (o, api) {\n    /**\n     * @private\n     * @type {module:zrender/container/Group}\n     */\n    this._containerGroup;\n    /**\n     * @private\n     * @type {Object.<string, Array.<module:zrender/container/Group>>}\n     */\n\n    this._storage = createStorage();\n    /**\n     * @private\n     * @type {module:echarts/data/Tree}\n     */\n\n    this._oldTree;\n    /**\n     * @private\n     * @type {module:echarts/chart/treemap/Breadcrumb}\n     */\n\n    this._breadcrumb;\n    /**\n     * @private\n     * @type {module:echarts/component/helper/RoamController}\n     */\n\n    this._controller;\n    /**\n     * 'ready', 'animating'\n     * @private\n     */\n\n    this._state = 'ready';\n  },\n\n  /**\n   * @override\n   */\n  render: function (seriesModel, ecModel, api, payload) {\n    var models = ecModel.findComponents({\n      mainType: 'series',\n      subType: 'treemap',\n      query: payload\n    });\n\n    if (zrUtil.indexOf(models, seriesModel) < 0) {\n      return;\n    }\n\n    this.seriesModel = seriesModel;\n    this.api = api;\n    this.ecModel = ecModel;\n    var types = ['treemapZoomToNode', 'treemapRootToNode'];\n    var targetInfo = helper.retrieveTargetInfo(payload, types, seriesModel);\n    var payloadType = payload && payload.type;\n    var layoutInfo = seriesModel.layoutInfo;\n    var isInit = !this._oldTree;\n    var thisStorage = this._storage; // Mark new root when action is treemapRootToNode.\n\n    var reRoot = payloadType === 'treemapRootToNode' && targetInfo && thisStorage ? {\n      rootNodeGroup: thisStorage.nodeGroup[targetInfo.node.getRawIndex()],\n      direction: payload.direction\n    } : null;\n\n    var containerGroup = this._giveContainerGroup(layoutInfo);\n\n    var renderResult = this._doRender(containerGroup, seriesModel, reRoot);\n\n    !isInit && (!payloadType || payloadType === 'treemapZoomToNode' || payloadType === 'treemapRootToNode') ? this._doAnimation(containerGroup, renderResult, seriesModel, reRoot) : renderResult.renderFinally();\n\n    this._resetController(api);\n\n    this._renderBreadcrumb(seriesModel, api, targetInfo);\n  },\n\n  /**\n   * @private\n   */\n  _giveContainerGroup: function (layoutInfo) {\n    var containerGroup = this._containerGroup;\n\n    if (!containerGroup) {\n      // FIXME\n      // 加一层containerGroup是为了clip，但是现在clip功能并没有实现。\n      containerGroup = this._containerGroup = new Group();\n\n      this._initEvents(containerGroup);\n\n      this.group.add(containerGroup);\n    }\n\n    containerGroup.attr('position', [layoutInfo.x, layoutInfo.y]);\n    return containerGroup;\n  },\n\n  /**\n   * @private\n   */\n  _doRender: function (containerGroup, seriesModel, reRoot) {\n    var thisTree = seriesModel.getData().tree;\n    var oldTree = this._oldTree; // Clear last shape records.\n\n    var lastsForAnimation = createStorage();\n    var thisStorage = createStorage();\n    var oldStorage = this._storage;\n    var willInvisibleEls = [];\n    var doRenderNode = zrUtil.curry(renderNode, seriesModel, thisStorage, oldStorage, reRoot, lastsForAnimation, willInvisibleEls); // Notice: when thisTree and oldTree are the same tree (see list.cloneShallow),\n    // the oldTree is actually losted, so we can not find all of the old graphic\n    // elements from tree. So we use this stragegy: make element storage, move\n    // from old storage to new storage, clear old storage.\n\n    dualTravel(thisTree.root ? [thisTree.root] : [], oldTree && oldTree.root ? [oldTree.root] : [], containerGroup, thisTree === oldTree || !oldTree, 0); // Process all removing.\n\n    var willDeleteEls = clearStorage(oldStorage);\n    this._oldTree = thisTree;\n    this._storage = thisStorage;\n    return {\n      lastsForAnimation: lastsForAnimation,\n      willDeleteEls: willDeleteEls,\n      renderFinally: renderFinally\n    };\n\n    function dualTravel(thisViewChildren, oldViewChildren, parentGroup, sameTree, depth) {\n      // When 'render' is triggered by action,\n      // 'this' and 'old' may be the same tree,\n      // we use rawIndex in that case.\n      if (sameTree) {\n        oldViewChildren = thisViewChildren;\n        each(thisViewChildren, function (child, index) {\n          !child.isRemoved() && processNode(index, index);\n        });\n      } // Diff hierarchically (diff only in each subtree, but not whole).\n      // because, consistency of view is important.\n      else {\n          new DataDiffer(oldViewChildren, thisViewChildren, getKey, getKey).add(processNode).update(processNode).remove(zrUtil.curry(processNode, null)).execute();\n        }\n\n      function getKey(node) {\n        // Identify by name or raw index.\n        return node.getId();\n      }\n\n      function processNode(newIndex, oldIndex) {\n        var thisNode = newIndex != null ? thisViewChildren[newIndex] : null;\n        var oldNode = oldIndex != null ? oldViewChildren[oldIndex] : null;\n        var group = doRenderNode(thisNode, oldNode, parentGroup, depth);\n        group && dualTravel(thisNode && thisNode.viewChildren || [], oldNode && oldNode.viewChildren || [], group, sameTree, depth + 1);\n      }\n    }\n\n    function clearStorage(storage) {\n      var willDeleteEls = createStorage();\n      storage && each(storage, function (store, storageName) {\n        var delEls = willDeleteEls[storageName];\n        each(store, function (el) {\n          el && (delEls.push(el), el.__tmWillDelete = 1);\n        });\n      });\n      return willDeleteEls;\n    }\n\n    function renderFinally() {\n      each(willDeleteEls, function (els) {\n        each(els, function (el) {\n          el.parent && el.parent.remove(el);\n        });\n      });\n      each(willInvisibleEls, function (el) {\n        el.invisible = true; // Setting invisible is for optimizing, so no need to set dirty,\n        // just mark as invisible.\n\n        el.dirty();\n      });\n    }\n  },\n\n  /**\n   * @private\n   */\n  _doAnimation: function (containerGroup, renderResult, seriesModel, reRoot) {\n    if (!seriesModel.get('animation')) {\n      return;\n    }\n\n    var duration = seriesModel.get('animationDurationUpdate');\n    var easing = seriesModel.get('animationEasing');\n    var animationWrap = animationUtil.createWrap(); // Make delete animations.\n\n    each(renderResult.willDeleteEls, function (store, storageName) {\n      each(store, function (el, rawIndex) {\n        if (el.invisible) {\n          return;\n        }\n\n        var parent = el.parent; // Always has parent, and parent is nodeGroup.\n\n        var target;\n\n        if (reRoot && reRoot.direction === 'drillDown') {\n          target = parent === reRoot.rootNodeGroup // This is the content element of view root.\n          // Only `content` will enter this branch, because\n          // `background` and `nodeGroup` will not be deleted.\n          ? {\n            shape: {\n              x: 0,\n              y: 0,\n              width: parent.__tmNodeWidth,\n              height: parent.__tmNodeHeight\n            },\n            style: {\n              opacity: 0\n            } // Others.\n\n          } : {\n            style: {\n              opacity: 0\n            }\n          };\n        } else {\n          var targetX = 0;\n          var targetY = 0;\n\n          if (!parent.__tmWillDelete) {\n            // Let node animate to right-bottom corner, cooperating with fadeout,\n            // which is appropriate for user understanding.\n            // Divided by 2 for reRoot rolling up effect.\n            targetX = parent.__tmNodeWidth / 2;\n            targetY = parent.__tmNodeHeight / 2;\n          }\n\n          target = storageName === 'nodeGroup' ? {\n            position: [targetX, targetY],\n            style: {\n              opacity: 0\n            }\n          } : {\n            shape: {\n              x: targetX,\n              y: targetY,\n              width: 0,\n              height: 0\n            },\n            style: {\n              opacity: 0\n            }\n          };\n        }\n\n        target && animationWrap.add(el, target, duration, easing);\n      });\n    }); // Make other animations\n\n    each(this._storage, function (store, storageName) {\n      each(store, function (el, rawIndex) {\n        var last = renderResult.lastsForAnimation[storageName][rawIndex];\n        var target = {};\n\n        if (!last) {\n          return;\n        }\n\n        if (storageName === 'nodeGroup') {\n          if (last.old) {\n            target.position = el.position.slice();\n            el.attr('position', last.old);\n          }\n        } else {\n          if (last.old) {\n            target.shape = zrUtil.extend({}, el.shape);\n            el.setShape(last.old);\n          }\n\n          if (last.fadein) {\n            el.setStyle('opacity', 0);\n            target.style = {\n              opacity: 1\n            };\n          } // When animation is stopped for succedent animation starting,\n          // el.style.opacity might not be 1\n          else if (el.style.opacity !== 1) {\n              target.style = {\n                opacity: 1\n              };\n            }\n        }\n\n        animationWrap.add(el, target, duration, easing);\n      });\n    }, this);\n    this._state = 'animating';\n    animationWrap.done(bind(function () {\n      this._state = 'ready';\n      renderResult.renderFinally();\n    }, this)).start();\n  },\n\n  /**\n   * @private\n   */\n  _resetController: function (api) {\n    var controller = this._controller; // Init controller.\n\n    if (!controller) {\n      controller = this._controller = new RoamController(api.getZr());\n      controller.enable(this.seriesModel.get('roam'));\n      controller.on('pan', bind(this._onPan, this));\n      controller.on('zoom', bind(this._onZoom, this));\n    }\n\n    var rect = new BoundingRect(0, 0, api.getWidth(), api.getHeight());\n    controller.setPointerChecker(function (e, x, y) {\n      return rect.contain(x, y);\n    });\n  },\n\n  /**\n   * @private\n   */\n  _clearController: function () {\n    var controller = this._controller;\n\n    if (controller) {\n      controller.dispose();\n      controller = null;\n    }\n  },\n\n  /**\n   * @private\n   */\n  _onPan: function (e) {\n    if (this._state !== 'animating' && (Math.abs(e.dx) > DRAG_THRESHOLD || Math.abs(e.dy) > DRAG_THRESHOLD)) {\n      // These param must not be cached.\n      var root = this.seriesModel.getData().tree.root;\n\n      if (!root) {\n        return;\n      }\n\n      var rootLayout = root.getLayout();\n\n      if (!rootLayout) {\n        return;\n      }\n\n      this.api.dispatchAction({\n        type: 'treemapMove',\n        from: this.uid,\n        seriesId: this.seriesModel.id,\n        rootRect: {\n          x: rootLayout.x + e.dx,\n          y: rootLayout.y + e.dy,\n          width: rootLayout.width,\n          height: rootLayout.height\n        }\n      });\n    }\n  },\n\n  /**\n   * @private\n   */\n  _onZoom: function (e) {\n    var mouseX = e.originX;\n    var mouseY = e.originY;\n\n    if (this._state !== 'animating') {\n      // These param must not be cached.\n      var root = this.seriesModel.getData().tree.root;\n\n      if (!root) {\n        return;\n      }\n\n      var rootLayout = root.getLayout();\n\n      if (!rootLayout) {\n        return;\n      }\n\n      var rect = new BoundingRect(rootLayout.x, rootLayout.y, rootLayout.width, rootLayout.height);\n      var layoutInfo = this.seriesModel.layoutInfo; // Transform mouse coord from global to containerGroup.\n\n      mouseX -= layoutInfo.x;\n      mouseY -= layoutInfo.y; // Scale root bounding rect.\n\n      var m = matrix.create();\n      matrix.translate(m, m, [-mouseX, -mouseY]);\n      matrix.scale(m, m, [e.scale, e.scale]);\n      matrix.translate(m, m, [mouseX, mouseY]);\n      rect.applyTransform(m);\n      this.api.dispatchAction({\n        type: 'treemapRender',\n        from: this.uid,\n        seriesId: this.seriesModel.id,\n        rootRect: {\n          x: rect.x,\n          y: rect.y,\n          width: rect.width,\n          height: rect.height\n        }\n      });\n    }\n  },\n\n  /**\n   * @private\n   */\n  _initEvents: function (containerGroup) {\n    containerGroup.on('click', function (e) {\n      if (this._state !== 'ready') {\n        return;\n      }\n\n      var nodeClick = this.seriesModel.get('nodeClick', true);\n\n      if (!nodeClick) {\n        return;\n      }\n\n      var targetInfo = this.findTarget(e.offsetX, e.offsetY);\n\n      if (!targetInfo) {\n        return;\n      }\n\n      var node = targetInfo.node;\n\n      if (node.getLayout().isLeafRoot) {\n        this._rootToNode(targetInfo);\n      } else {\n        if (nodeClick === 'zoomToNode') {\n          this._zoomToNode(targetInfo);\n        } else if (nodeClick === 'link') {\n          var itemModel = node.hostTree.data.getItemModel(node.dataIndex);\n          var link = itemModel.get('link', true);\n          var linkTarget = itemModel.get('target', true) || 'blank';\n          link && window.open(link, linkTarget);\n        }\n      }\n    }, this);\n  },\n\n  /**\n   * @private\n   */\n  _renderBreadcrumb: function (seriesModel, api, targetInfo) {\n    if (!targetInfo) {\n      targetInfo = seriesModel.get('leafDepth', true) != null ? {\n        node: seriesModel.getViewRoot() // FIXME\n        // better way?\n        // Find breadcrumb tail on center of containerGroup.\n\n      } : this.findTarget(api.getWidth() / 2, api.getHeight() / 2);\n\n      if (!targetInfo) {\n        targetInfo = {\n          node: seriesModel.getData().tree.root\n        };\n      }\n    }\n\n    (this._breadcrumb || (this._breadcrumb = new Breadcrumb(this.group))).render(seriesModel, api, targetInfo.node, bind(onSelect, this));\n\n    function onSelect(node) {\n      if (this._state !== 'animating') {\n        helper.aboveViewRoot(seriesModel.getViewRoot(), node) ? this._rootToNode({\n          node: node\n        }) : this._zoomToNode({\n          node: node\n        });\n      }\n    }\n  },\n\n  /**\n   * @override\n   */\n  remove: function () {\n    this._clearController();\n\n    this._containerGroup && this._containerGroup.removeAll();\n    this._storage = createStorage();\n    this._state = 'ready';\n    this._breadcrumb && this._breadcrumb.remove();\n  },\n  dispose: function () {\n    this._clearController();\n  },\n\n  /**\n   * @private\n   */\n  _zoomToNode: function (targetInfo) {\n    this.api.dispatchAction({\n      type: 'treemapZoomToNode',\n      from: this.uid,\n      seriesId: this.seriesModel.id,\n      targetNode: targetInfo.node\n    });\n  },\n\n  /**\n   * @private\n   */\n  _rootToNode: function (targetInfo) {\n    this.api.dispatchAction({\n      type: 'treemapRootToNode',\n      from: this.uid,\n      seriesId: this.seriesModel.id,\n      targetNode: targetInfo.node\n    });\n  },\n\n  /**\n   * @public\n   * @param {number} x Global coord x.\n   * @param {number} y Global coord y.\n   * @return {Object} info If not found, return undefined;\n   * @return {number} info.node Target node.\n   * @return {number} info.offsetX x refer to target node.\n   * @return {number} info.offsetY y refer to target node.\n   */\n  findTarget: function (x, y) {\n    var targetInfo;\n    var viewRoot = this.seriesModel.getViewRoot();\n    viewRoot.eachNode({\n      attr: 'viewChildren',\n      order: 'preorder'\n    }, function (node) {\n      var bgEl = this._storage.background[node.getRawIndex()]; // If invisible, there might be no element.\n\n\n      if (bgEl) {\n        var point = bgEl.transformCoordToLocal(x, y);\n        var shape = bgEl.shape; // For performance consideration, dont use 'getBoundingRect'.\n\n        if (shape.x <= point[0] && point[0] <= shape.x + shape.width && shape.y <= point[1] && point[1] <= shape.y + shape.height) {\n          targetInfo = {\n            node: node,\n            offsetX: point[0],\n            offsetY: point[1]\n          };\n        } else {\n          return false; // Suppress visit subtree.\n        }\n      }\n    }, this);\n    return targetInfo;\n  }\n});\n/**\n * @inner\n */\n\n\nfunction createStorage() {\n  return {\n    nodeGroup: [],\n    background: [],\n    content: []\n  };\n}\n/**\n * @inner\n * @return Return undefined means do not travel further.\n */\n\n\nfunction renderNode(seriesModel, thisStorage, oldStorage, reRoot, lastsForAnimation, willInvisibleEls, thisNode, oldNode, parentGroup, depth) {\n  // Whether under viewRoot.\n  if (!thisNode) {\n    // Deleting nodes will be performed finally. This method just find\n    // element from old storage, or create new element, set them to new\n    // storage, and set styles.\n    return;\n  } // -------------------------------------------------------------------\n  // Start of closure variables available in \"Procedures in renderNode\".\n\n\n  var thisLayout = thisNode.getLayout();\n\n  if (!thisLayout || !thisLayout.isInView) {\n    return;\n  }\n\n  var thisWidth = thisLayout.width;\n  var thisHeight = thisLayout.height;\n  var borderWidth = thisLayout.borderWidth;\n  var thisInvisible = thisLayout.invisible;\n  var thisRawIndex = thisNode.getRawIndex();\n  var oldRawIndex = oldNode && oldNode.getRawIndex();\n  var thisViewChildren = thisNode.viewChildren;\n  var upperHeight = thisLayout.upperHeight;\n  var isParent = thisViewChildren && thisViewChildren.length;\n  var itemStyleNormalModel = thisNode.getModel('itemStyle');\n  var itemStyleEmphasisModel = thisNode.getModel('emphasis.itemStyle'); // End of closure ariables available in \"Procedures in renderNode\".\n  // -----------------------------------------------------------------\n  // Node group\n\n  var group = giveGraphic('nodeGroup', Group);\n\n  if (!group) {\n    return;\n  }\n\n  parentGroup.add(group); // x,y are not set when el is above view root.\n\n  group.attr('position', [thisLayout.x || 0, thisLayout.y || 0]);\n  group.__tmNodeWidth = thisWidth;\n  group.__tmNodeHeight = thisHeight;\n\n  if (thisLayout.isAboveViewRoot) {\n    return group;\n  } // Background\n\n\n  var bg = giveGraphic('background', Rect, depth, Z_BG);\n  bg && renderBackground(group, bg, isParent && thisLayout.upperHeight); // No children, render content.\n\n  if (!isParent) {\n    var content = giveGraphic('content', Rect, depth, Z_CONTENT);\n    content && renderContent(group, content);\n  }\n\n  return group; // ----------------------------\n  // | Procedures in renderNode |\n  // ----------------------------\n\n  function renderBackground(group, bg, useUpperLabel) {\n    // For tooltip.\n    bg.dataIndex = thisNode.dataIndex;\n    bg.seriesIndex = seriesModel.seriesIndex;\n    bg.setShape({\n      x: 0,\n      y: 0,\n      width: thisWidth,\n      height: thisHeight\n    });\n    var visualBorderColor = thisNode.getVisual('borderColor', true);\n    var emphasisBorderColor = itemStyleEmphasisModel.get('borderColor');\n    updateStyle(bg, function () {\n      var normalStyle = getItemStyleNormal(itemStyleNormalModel);\n      normalStyle.fill = visualBorderColor;\n      var emphasisStyle = getItemStyleEmphasis(itemStyleEmphasisModel);\n      emphasisStyle.fill = emphasisBorderColor;\n\n      if (useUpperLabel) {\n        var upperLabelWidth = thisWidth - 2 * borderWidth;\n        prepareText(normalStyle, emphasisStyle, visualBorderColor, upperLabelWidth, upperHeight, {\n          x: borderWidth,\n          y: 0,\n          width: upperLabelWidth,\n          height: upperHeight\n        });\n      } // For old bg.\n      else {\n          normalStyle.text = emphasisStyle.text = null;\n        }\n\n      bg.setStyle(normalStyle);\n      graphic.setHoverStyle(bg, emphasisStyle);\n    });\n    group.add(bg);\n  }\n\n  function renderContent(group, content) {\n    // For tooltip.\n    content.dataIndex = thisNode.dataIndex;\n    content.seriesIndex = seriesModel.seriesIndex;\n    var contentWidth = Math.max(thisWidth - 2 * borderWidth, 0);\n    var contentHeight = Math.max(thisHeight - 2 * borderWidth, 0);\n    content.culling = true;\n    content.setShape({\n      x: borderWidth,\n      y: borderWidth,\n      width: contentWidth,\n      height: contentHeight\n    });\n    var visualColor = thisNode.getVisual('color', true);\n    updateStyle(content, function () {\n      var normalStyle = getItemStyleNormal(itemStyleNormalModel);\n      normalStyle.fill = visualColor;\n      var emphasisStyle = getItemStyleEmphasis(itemStyleEmphasisModel);\n      prepareText(normalStyle, emphasisStyle, visualColor, contentWidth, contentHeight);\n      content.setStyle(normalStyle);\n      graphic.setHoverStyle(content, emphasisStyle);\n    });\n    group.add(content);\n  }\n\n  function updateStyle(element, cb) {\n    if (!thisInvisible) {\n      // If invisible, do not set visual, otherwise the element will\n      // change immediately before animation. We think it is OK to\n      // remain its origin color when moving out of the view window.\n      cb();\n\n      if (!element.__tmWillVisible) {\n        element.invisible = false;\n      }\n    } else {\n      // Delay invisible setting utill animation finished,\n      // avoid element vanish suddenly before animation.\n      !element.invisible && willInvisibleEls.push(element);\n    }\n  }\n\n  function prepareText(normalStyle, emphasisStyle, visualColor, width, height, upperLabelRect) {\n    var nodeModel = thisNode.getModel();\n    var text = zrUtil.retrieve(seriesModel.getFormattedLabel(thisNode.dataIndex, 'normal', null, null, upperLabelRect ? 'upperLabel' : 'label'), nodeModel.get('name'));\n\n    if (!upperLabelRect && thisLayout.isLeafRoot) {\n      var iconChar = seriesModel.get('drillDownIcon', true);\n      text = iconChar ? iconChar + ' ' + text : text;\n    }\n\n    var normalLabelModel = nodeModel.getModel(upperLabelRect ? PATH_UPPERLABEL_NORMAL : PATH_LABEL_NOAMAL);\n    var emphasisLabelModel = nodeModel.getModel(upperLabelRect ? PATH_UPPERLABEL_EMPHASIS : PATH_LABEL_EMPHASIS);\n    var isShow = normalLabelModel.getShallow('show');\n    graphic.setLabelStyle(normalStyle, emphasisStyle, normalLabelModel, emphasisLabelModel, {\n      defaultText: isShow ? text : null,\n      autoColor: visualColor,\n      isRectText: true\n    });\n    upperLabelRect && (normalStyle.textRect = zrUtil.clone(upperLabelRect));\n    normalStyle.truncate = isShow && normalLabelModel.get('ellipsis') ? {\n      outerWidth: width,\n      outerHeight: height,\n      minChar: 2\n    } : null;\n  }\n\n  function giveGraphic(storageName, Ctor, depth, z) {\n    var element = oldRawIndex != null && oldStorage[storageName][oldRawIndex];\n    var lasts = lastsForAnimation[storageName];\n\n    if (element) {\n      // Remove from oldStorage\n      oldStorage[storageName][oldRawIndex] = null;\n      prepareAnimationWhenHasOld(lasts, element, storageName);\n    } // If invisible and no old element, do not create new element (for optimizing).\n    else if (!thisInvisible) {\n        element = new Ctor({\n          z: calculateZ(depth, z)\n        });\n        element.__tmDepth = depth;\n        element.__tmStorageName = storageName;\n        prepareAnimationWhenNoOld(lasts, element, storageName);\n      } // Set to thisStorage\n\n\n    return thisStorage[storageName][thisRawIndex] = element;\n  }\n\n  function prepareAnimationWhenHasOld(lasts, element, storageName) {\n    var lastCfg = lasts[thisRawIndex] = {};\n    lastCfg.old = storageName === 'nodeGroup' ? element.position.slice() : zrUtil.extend({}, element.shape);\n  } // If a element is new, we need to find the animation start point carefully,\n  // otherwise it will looks strange when 'zoomToNode'.\n\n\n  function prepareAnimationWhenNoOld(lasts, element, storageName) {\n    var lastCfg = lasts[thisRawIndex] = {};\n    var parentNode = thisNode.parentNode;\n\n    if (parentNode && (!reRoot || reRoot.direction === 'drillDown')) {\n      var parentOldX = 0;\n      var parentOldY = 0; // New nodes appear from right-bottom corner in 'zoomToNode' animation.\n      // For convenience, get old bounding rect from background.\n\n      var parentOldBg = lastsForAnimation.background[parentNode.getRawIndex()];\n\n      if (!reRoot && parentOldBg && parentOldBg.old) {\n        parentOldX = parentOldBg.old.width;\n        parentOldY = parentOldBg.old.height;\n      } // When no parent old shape found, its parent is new too,\n      // so we can just use {x:0, y:0}.\n\n\n      lastCfg.old = storageName === 'nodeGroup' ? [0, parentOldY] : {\n        x: parentOldX,\n        y: parentOldY,\n        width: 0,\n        height: 0\n      };\n    } // Fade in, user can be aware that these nodes are new.\n\n\n    lastCfg.fadein = storageName !== 'nodeGroup';\n  }\n} // We can not set all backgroud with the same z, Because the behaviour of\n// drill down and roll up differ background creation sequence from tree\n// hierarchy sequence, which cause that lowser background element overlap\n// upper ones. So we calculate z based on depth.\n// Moreover, we try to shrink down z interval to [0, 1] to avoid that\n// treemap with large z overlaps other components.\n\n\nfunction calculateZ(depth, zInLevel) {\n  var zb = depth * Z_BASE + zInLevel;\n  return (zb - 1) / zb;\n}\n\nmodule.exports = _default;"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}